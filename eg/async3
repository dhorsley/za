#!/usr/bin/za -S

locks(true)

define f(v)
    # generally, do some work in here..
    println v,"->",has_shell()
    z =| date --rfc-3339=ns
    pause rand(2000)
    return z
enddef

# launch all in parallel
for x=0 to 99
    async hndmap f(x) x
endfor

# collect results
println "Waiting for task completions."
res=await(hndmap,true)
for e=0 to 99
    println "{e} -> {res[e]}"
endfor

