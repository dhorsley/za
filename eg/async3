#!/usr/bin/za

locks(true)
coproc(false)

define f(z)
    # generally, do some work in here..
    z =| date --rfc-3339=ns
    pause rand(2000)
    return z
enddef

# launch all in parallel
for x=0 to 99
    async hndmap f(x) x
endfor

# collect results
println "Waiting for task completions."
res=await(hndmap,true)
for e=0 to 99
    println "{e} -> {res[e]}"
endfor

