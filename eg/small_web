#!/usr/bin/za

# minimal static web server below.

HOST="192.168.1.18"
PORT=61440
HOME_PATH="/home/daniel/go/src/za/eg/www/exmachina"

userSigIntHandler="cleanup(sid)"

define cleanup(s)
    web_serve_stop(s)
    log "Server [#{s}] Stopped.\n"
    exit 0
enddef

locks(true)

sid = web_serve_start(HOME_PATH,PORT,HOST)

log "Server [#{sid}] Started.\n"

web_serve_path(sid, "s",
    "^/$", "http://{HOST}:{PORT}/index.html"
)

web_serve_path(sid, "s",
    `/(.*\.(|html?|js|css|png|jpg|ico))$`, `http://{HOST}:{PORT}/$1`
)

web_serve_path(sid, "s",
    "^/(.*)/$", "http://{HOST}:{PORT}/$1/index.html"
)

while web_serve_up(sid)
    # in process tasks go here:
    pause 200
endwhile


