#!/usr/bin/za


def quit()
    repoll=poll_dur
    while
        if repoll--<=0
            if w!=term_w() or h!=term_h()
                @ w=term_w()
                @ h=term_h()
                cls
            endif
            repoll=poll_dur
        endif
        k=keypress(1000)
        break if k!=0
    endwhile
    @quitting=true
    at h-1,1
    cls
    cursoron()
    exit
end


# MAIN

poll_dur=7

bh,bw=[4,8]
w=term_w()
h=term_h()
quitting=false

async nil quit()

cls
cursoroff()
while not quitting

    row_count=as_int(h/bh)
    col_count=as_int(w/bw)
    
    for r=0 to row_count
        continue if r*bh>=term_h()
        for c=0 to col_count
            continue if c*bw>=term_w()
            hue="[#b{=rand(7)}]"
            for sr=0 to bh-1
                at r*bh+sr,c*bw
                print hue," "*bw
            endfor
        endfor
    endfor

endwhile

