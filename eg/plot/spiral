#!/usr/bin/za


define waitkey()
    keypress()
    setglob quit=true
end

define draw()
    x = 2*theta * cos(theta / pi)/8
    y = theta * sin(theta / pi)/8
    px=cx+x; py=cy+y
    if px>0 && py>0 && px<width && py<height
        at py,px; print "[#b"+int(c)+"]·"
    endif
    setglob theta = theta + rotation
    on x > width/2.0 do setglob theta = 0.0
    setglob c+=crate
    on c>7 do setglob c=7
    on c<1 do setglob c=1
    setglob crate=(49-rand(100))/10.0
end

var rotation  float
var theta     float

rotation = 0.05
width=term_w()
height=term_h()
cx=width/2
cy=height/2
pi=pi()
c=rand(7)
crate=0.1
bounce=0.025
maxrot=13.0

seed(epoch_nano_time())

quit=false
async wait_handle waitkey()

while !quit
    cls
    cursoroff()
    theta=0.0
    for e=0 to 5000
        draw()
        at 1,1
        print "[##][#6]θ ",theta.int, "[#-]"
    endfor
    rotation+=bounce
    on rotation>maxrot || rotation<0.03 do bounce=-bounce
endwhile
cursoron()
at height-1,1

