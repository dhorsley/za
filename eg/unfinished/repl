#!/usr/bin/za

DOC "Simple REPL loop example"


define show_help()
    at 1,1; print "Commands:"
    at 2,1; print "help, echo, quit"
enddef

define process(i)

    on i=="" do return
    fields(i)
    on count(F)==0 do return

    pane select "output"
    pane redraw

    clear_line(1,1); at 1,1

    statement=F1
    # remove entire list + statement from fields:
    print format("%#v\n",F)
    F=tail(F); F=tail(F)
 
    when lower(statement)
    is "help"
        show_help()
    is "quit"
        setglob term true
    is "echo"
        foreach f in F
            print f
        endfor
    or
        print "Error - unknown command: {F1}\n"
    endwhen

enddef


#
# MAIN
#

cls
#            name    row            col             h        w             title                      border
pane define "input",1,1,4,term_w(),"","round"
pane define "output",6,1,20,term_w(),"","round"

term=false
while term==false

    pane select "input"
    pane redraw

    prompt inp "> "
    process(inp)

endwhile

pane select "global"
at 27,1

exit 0

