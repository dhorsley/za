#!/usr/bin/za

# test all of the string functions

module "../modules/test_string_setup"

define header(n)
    println "\n[#1]{n}[#-]"
enddef

test "lines" group "string"
    header(_test_name)
    l=lines(s,"25:25")
    doc "line : {l}"
    assert field(l,1)=="25"
endtest 

test "field-lower-substr" group "string"
    header(_test_name)
    w=lower(field(l,2))
    assert substr(w,0,len(w)-1)=="french"
    doc "word : {w}"
endtest

test "field" group "string"
    header(_test_name)
    assert field(l,12)=="g√®le"
endtest

test "pad" group "string"
    header(_test_name)
    t="*"
    doc "left justify   : ",pad(t,-1,9,"-")
    assert pad(t,-1,9,"-") == "*--------"
    doc "centre justify : ",pad(t, 0,9,"-")
    assert pad(t, 0,9,"-") == "----*----"
    doc "right justify  : ",pad(t, 1,9,"-")
    assert pad(t, 1,9,"-") == "--------*"
endtest

test "count" group "string"
    header(_test_name)

    with s as file
        ac =| awk 'END{print NR}' {file}
        wc =| wc -l {file} | cut -f1 -d" "
    endwith

#    f=|mktemp
#    write_file(f,s)
#    ac =| awk 'END{print NR}' {f}
#    wc =| wc -l {f} | cut -f1 -d" "
#    | rm -f {f}

    println "awk thinks : {ac}"
    println "wc thinks  : {wc}"
    println "we think   : {count(s)}"

    assert count(s) == 33

endtest

doc ` "get_value", "start", "end", "match", "filter",
      "substr", "gsub", "replace", "trim", "count",
      "line_add", "line_delete", "line_replace", "line_add_before", "line_add_after","line_match","line_filter","line_head","line_tail",
      "reverse", "tr", "lower", "upper", "format", "split", "join", "collapse","strpos",
`

