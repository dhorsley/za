#!/usr/bin/env za

# Basic variadic function tests without complex infrastructure

module "libc.so.6" as c
use +c

# Declare variadic functions
lib c::printf(format:string, ...args) -> int
lib c::sprintf(buffer:pointer, format:string, ...args) -> int

println "Basic Variadic Function Tests"
println "=============================="
println

# Test 1: Integer formatting
println "[#6]Test 1: Integer formatting[#-]"
result = c::printf("Integer: %d\n", 42)
println "  Bytes written: " + as_string(result)
println "  ✓ Test passed"
println

# Test 2: Multiple integers
println "[#6]Test 2: Multiple integers[#-]"
result = c::printf("Two ints: %d %d\n", 10, 20)
println "  Bytes written: " + as_string(result)
println "  ✓ Test passed"
println

# Test 3: Floating point
println "[#6]Test 3: Floating point[#-]"
result = c::printf("Float: %f\n", 3.14159)
println "  Bytes written: " + as_string(result)
println "  ✓ Test passed"
println

# Test 4: String formatting
println "[#6]Test 4: String formatting[#-]"
result = c::printf("String: %s\n", "Hello")
println "  Bytes written: " + as_string(result)
println "  ✓ Test passed"
println

# Test 5: Mixed types
println "[#6]Test 5: Mixed types[#-]"
result = c::printf("Mixed: %d %f %s\n", 42, 3.14, "test")
println "  Bytes written: " + as_string(result)
println "  ✓ Test passed"
println

# Test 6: Many arguments (8 integers)
println "[#6]Test 6: Many arguments[#-]"
result = c::printf("Many: %d %d %d %d %d %d %d %d\n", 1, 2, 3, 4, 5, 6, 7, 8)
println "  Bytes written: " + as_string(result)
println "  ✓ Test passed"
println

# Test 7: sprintf (string building)
println "[#6]Test 7: sprintf string building[#-]"
buffer = c_alloc(256)
result = c::sprintf(buffer, "Value: %d, Pi: %f, Text: %s", 42, 3.14159, "Hello")
println "  Bytes written: " + as_string(result)
c_free(buffer)
println "  ✓ Test passed"
println

# Test 8: Format specifiers with precision
println "[#6]Test 8: Format precision[#-]"
result = c::printf("Precision: %.2f\n", 3.14159)
println "  Bytes written: " + as_string(result)
println "  ✓ Test passed"
println

# Test 9: Pointer formatting
println "[#6]Test 9: Pointer formatting[#-]"
test_ptr = c_alloc(64)
result = c::printf("Pointer: %p\n", test_ptr)
c_free(test_ptr)
println "  Bytes written: " + as_string(result)
println "  ✓ Test passed"
println

# Test 10: Character formatting
println "[#6]Test 10: Character formatting[#-]"
result = c::printf("Char: %c\n", 65)
println "  Bytes written: " + as_string(result)
println "  ✓ Test passed"
println

println "========================================="
println "[#2]All tests PASSED![#-]"
println "========================================="
println
println "Variadic function support is working correctly!"
println "Type inference appears to be functioning properly."
