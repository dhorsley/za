#!/usr/bin/env za

println "\n[#1]Auto-Exception Checks[#-]\n"

# Test 1: Array bounds error (runtime panic → auto-exception)
println "Test 1: Array bounds error (runtime panic)"
try
    arr = [1, 2, 3]
    result = arr[10]  # This will cause out-of-bounds panic
    println "This should not print"
catch err is "error"
    println "- Caught array bounds error as exception"
    println err.stack_trace.format_stack_trace
endtry
print

# Test 2: Division by zero (runtime panic → auto-exception)
println "Test 2: Division by zero (runtime panic)"
try
    result = 1 / 0  # This will cause divide by zero panic
    println "This should not print"
catch err is "error"
    println "- Caught division by zero as exception"
    println err.stack_trace.format_stack_trace
endtry
print

# Test 3: Undefined function (runtime panic → auto-exception)
println "Test 3: Undefined function (runtime panic)"
try
    result = undefined_function()  # This will cause uninitialised function panic
    println "This should not print"
catch err is "error"
    println "- Caught undefined function as exception"
    println err.stack_trace.format_stack_trace
endtry
print

# Test 4: Custom exception category with try throws
println "Test 4: Custom exception category"
try throws "database"
    result = 1 / 0  # Runtime panic converted to "database" category exception
    println "This should not print"
catch err is "database"
    println "- Caught with custom category 'database'"
    println err.stack_trace.format_stack_trace
endtry
print

# Test 5: Nil return (NOT a panic → no auto-exception, explicit handling needed)
println "Test 5: Function returning nil (not a panic - requires explicit handling)"
def returns_nil()
    return nil # Returns nil, no panic
end

try
    result = returns_nil()  # This returns nil, doesn't panic
    if result == nil
        println "Function returned nil (not an exception)"
    else
        println "Function returned:", result
    endif
catch err is "error"
    println "This won't execute - no exception was thrown"
endtry

println "For nil checking, use ?? operator explicitly:\n"
try
    result = returns_nil() ?? "function returned nil"
    println "Result with ?? operator:", result
catch err
    println "- Caught explicit exception:"
    println err.stack_trace.format_stack_trace
    println "Full error:"
    println err.pp
endtry


