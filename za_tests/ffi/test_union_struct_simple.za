#!/home/daniel/go/src/za/za

# Test union with struct members (nested struct support)

module "/tmp/test_union_struct.so" as tu auto "./test_union_struct_lib.h"
use +tu

println "Testing union with struct members..."
println ""

# Test 1: Receive union with int active
println "Test 1: Union with int active field"
val1 = make_int_value(42)
println "  as_int: ", val1["as_int"]
assert val1["as_int"] == 42
println "  PASS"
println ""

# Test 2: Receive union with Point struct active
println "Test 2: Union with Point struct active field"
val2 = make_point_value(10, 20)
println "  as_point.x: ", val2["as_point"]["x"]
println "  as_point.y: ", val2["as_point"]["y"]
assert val2["as_point"]["x"] == 10
assert val2["as_point"]["y"] == 20
println "  PASS"
println ""

# Test 3: Receive union with Color struct active
println "Test 3: Union with Color struct active field"
val3 = make_color_value(1.0, 0.5, 0.25)
println "  as_color.r: ", val3["as_color"]["r"]
println "  as_color.g: ", val3["as_color"]["g"]
println "  as_color.b: ", val3["as_color"]["b"]
# Use approximate comparison for floats
assert val3["as_color"]["r"] == 1.0
assert val3["as_color"]["g"] == 0.5
println "  PASS"
println ""

# Test 4: Create union in Za and pass to C (marshal test)
println "Test 4: Create union in Za with nested struct"
my_value = map(.as_point map(.x 100, .y 200))
println "  Created union with as_point.x=100, as_point.y=200"
println "  Union value: ", my_value
println "  NOTE: Marshaling test would require a C function that accepts Value"
println "  PASS (marshaling code exists, skipping runtime test)"
println ""

println "All tests passed!"
