#!/usr/bin/za
# Test c_ptr_to_int function

println "Loading libc..."
module "libc.so.6" as c
use +c
LIB c::malloc(size:int) -> ptr
LIB c::free(p:ptr) -> void
println "Library loaded"

println "Calling malloc(100)..."
ptr_result = malloc(100)
println "malloc returned a pointer"

println "Converting pointer to int..."
int_result = c_ptr_to_int(ptr_result)
println "c_ptr_to_int returned: {int_result}"

println "Freeing memory..."
free(ptr_result)

if int_result > 0
    println "SUCCESS: pointer converted to positive integer: {int_result}"
else
    println "FAIL: expected positive integer, got {int_result}"
endif
