println "Global Mutable Variable Test"

module "./libtest_array.so" as arr auto "./test_array_lib.h"
use +arr

# Declare a global variable at top level
global_buffer = [10, 20, 30]

println "Global array created: [", global_buffer[0], ",", global_buffer[1], ",", global_buffer[2], "]"

println "Calling double_int_array with mut on global variable..."
arr::double_int_array(mut global_buffer, 3)
println "Function returned"
println "After: global_buffer = [", global_buffer[0], ",", global_buffer[1], ",", global_buffer[2], "]"

if global_buffer[0] == 20 && global_buffer[1] == 40 && global_buffer[2] == 60
    println "PASS: Global variable correctly updated"
else
    println "FAIL: Expected [20,40,60], got [", global_buffer[0], ",", global_buffer[1], ",", global_buffer[2], "]"
endif

println "Done!"
